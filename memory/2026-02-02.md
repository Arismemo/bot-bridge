# 2026-02-02 记忆

## Brave Search API 配置成功 ✅

**API Key**: `BSAFolhsKnad6fTt6oJiSVS-jkSK300`

### 配置方法
1. 修改 `~/.claw/openclaw.json` 添加：
   ```json
   "tools": {
     "web": {
       "search": {
         "enabled": true,
         "provider": "brave",
         "apiKey": "BSAFolhsKnad6fTt6oJiSVS-jkSK300",
         "maxResults": 10,
         "timeoutSeconds": 30
       }
     }
   }
   ```

2. 在 `~/Library/LaunchAgents/ai.openclaw.gateway.plist` 添加环境变量：
   ```xml
   <key>BRAVE_API_KEY</key>
   <string>BSAFolhsKnad6fTt6oJiSVS-jkSK300</string>
   ```

3. 重启服务：
   ```bash
   launchctl unload ~/Library/LaunchAgents/ai.openclaw.gateway.plist
   launchctl load ~/Library/LaunchAgents/ai.openclaw.gateway.plist
   ```

## 搜索功能状态总结

| 渠道 | 状态 | 说明 |
|-------|------|------|
| **Web Search (Brave)** | ✅ 正常 | 已配置 API key |
| **Web Fetch** | ✅ 正常 | 可获取解析网页 |
| **Moltbook 搜索** | ✅ 正常 | `moltbook.sh` 可用 |
| **X/Twitter 搜索** | ✅ 正常 | `bird search` 可用 |
| **邮件搜索 (Himalaya)** | ⚠️ 需配置 | 支持强大过滤，需先配置账户 |
| **iMessage 搜索** | ❌ 不支持 | imsg 工具无搜索功能 |

## Himalaya 邮件搜索语法

```bash
# 基本语法
himalaya envelope list [QUERY]

# 过滤条件
- date <yyyy-mm-dd>           # 特定日期
- before <yyyy-mm-dd>         # 之前
- after <yyyy-mm-dd>          # 之后
- from <pattern>              # 发件人
- to <pattern>                # 收件人
- subject <pattern>           # 主题
- body <pattern>              # 正文
- flag <flag>                # 标记

# 排序
himalaya envelope list ... order by date desc

# 组合示例
himalaya envelope list from "test" and subject "重要" order by date desc
```

## 技术细节

### OpenClaw 配置 Schema
- 正确路径: `tools.web.search.apiKey`
- 不是: `web.braveApiKey`

### 配置更新触发
- `gateway config.patch` 会触发 `SIGUSR1` 重启信号
- 自动重启延迟: 2 秒

### iMessage 搜索状态
- **已放弃**: imsg 工具本身不支持搜索，且 macOS 安全限制无法直接访问 Messages 数据库
- 用户决定关闭此功能

## Bot Bridge v2.0.0 交付完成 ✅

**GitHub**: https://github.com/Arismemo/bot-bridge-cli
**Gitee**: https://gitee.com/john121/bot-bridge-cli

### 交付内容
- ✅ 代码覆盖率：BotBridgeClient 92.45%, ContextAwareClient 96.66%
- ✅ 58 个测试全部通过
- ✅ 依赖注入架构（接口层 + 适配器层）
- ✅ 一键安装脚本（GitHub + Gitee）
- ✅ 完整文档（README, SKILL.md, 安装指南）

### 安装命令
```bash
# 服务器（GitHub）
curl -sSL https://raw.githubusercontent.com/Arismemo/bot-bridge-cli/master/install-server.sh | bash

# 服务器（Gitee - 国内更快）
curl -sSL https://gitee.com/john121/bot-bridge-cli/raw/master/install-server.sh | bash

# 客户端（发给 OpenClaw 机器人）
/install https://github.com/Arismemo/bot-bridge-cli
```

## Bot 管理机制说明

### 多 Bot 支持
- **Bot Bridge**: 让多个 OpenClaw bots 互相通信的服务
- **设计目标**: 支持无限多个 bots 互联（主 bot、专用 bot、测试 bot、远程 bot）
- **通信方式**: WebSocket + HTTP 双通道

### 错误分析：Validation failed for tool "message": [/Replying]

**触发时间**: 2026-02-02 03:03 (GMT+8)
**触发来源**: "Jack Daily Report" 定时任务（每天 3:00 AM）

**原因**: 某个 bot 在发送回复时，使用了 `[/Replying]` 前缀，被 OpenClaw 验证拒绝（以 `/` 开头被误认为命令）

**解决方案**: 移除或修改前缀（将 `[/Replying` 改为 `[Replying`），或使用 `console.debug` 而不是消息前缀

**Bot Bridge 状态**: 进程在运行（PID 34048），但端口 3000 未监听，服务可能未正常启动

**详细分析文档**: `/Users/liukun/.openclaw/workspace/BOT_MANAGEMENT_EXPLAINED.md`
